{% extends "base.html" %}

{% block title %}Dashboard - Email Scraper{% endblock %}

{% block body %}
<div class="dashboard-container">
    {% include '_sidebar.html' %}
    
    <main class="main-content">
        <div class="content-header">
            <h1>Dashboard</h1>
            <button class="btn btn-primary" onclick="showNewProjectModal()">
                <i class="fas fa-plus"></i> New Project
            </button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #3498DB;">
                    <i class="fas fa-folder"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ projects|length }}</h3>
                    <p>Total Projects</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #27AE60;">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ projects|sum(attribute='emails_found') }}</h3>
                    <p>Emails Found</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #F39C12;">
                    <i class="fas fa-spinner"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ projects|selectattr('status', 'equalto', 'running')|list|length }}</h3>
                    <p>Running Projects</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="background-color: #27AE60;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ projects|selectattr('status', 'equalto', 'completed')|list|length }}</h3>
                    <p>Completed</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2>Recent Projects</h2>
            </div>
            <div class="card-body">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Status</th>
                            <th>Progress</th>
                            <th>URLs</th>
                            <th>Emails Found</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for project in projects[:10] %}
                        <tr>
                            <td>{{ project.name }}</td>
                            <td>
                                <span class="badge badge-{{ project.status }}">
                                    {{ project.status|capitalize }}
                                </span>
                            </td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ project.progress }}%;"></div>
                                    <span class="progress-text">{{ project.progress }}%</span>
                                </div>
                            </td>
                            <td>{{ project.processed_urls }} / {{ project.total_urls }}</td>
                            <td>{{ project.emails_found }}</td>
                            <td>{{ project.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                <a href="{{ url_for('views.projects') }}#project-{{ project.id }}" class="btn btn-sm btn-secondary">
                                    <i class="fas fa-eye"></i> View
                                </a>
                                <button class="btn btn-sm btn-danger" onclick="deleteProject({{ project.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="text-center">No projects yet. Create your first project!</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<div id="newProjectModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create New Project</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <form id="newProjectForm" enctype="multipart/form-data">
            <div class="modal-body">
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <input type="text" id="projectName" name="name" required class="form-control">
                </div>
                
                <div class="form-group">
                    <label>Add URLs/Domains</label>
                    <div class="tab-buttons">
                        <button type="button" class="tab-btn active" onclick="switchTab('manual')">Manual Entry</button>
                        <button type="button" class="tab-btn" onclick="switchTab('csv')">Upload CSV</button>
                    </div>
                </div>
                
                <div id="manualTab" class="tab-content active">
                    <div class="form-group">
                        <label for="urls">Enter URLs (one per line)</label>
                        <textarea id="urls" name="urls" rows="8" class="form-control" placeholder="example.com&#10;https://www.example2.com&#10;http://example3.com"></textarea>
                        <small>You can enter domains with or without http://, https://, or www</small>
                    </div>
                </div>
                
                <div id="csvTab" class="tab-content">
                    <div class="form-group">
                        <label for="csvFile">Upload CSV File</label>
                        <input type="file" id="csvFile" name="csv_file" accept=".csv" class="form-control">
                        <small>CSV should contain a column named 'url' or 'domain'</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Project</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
